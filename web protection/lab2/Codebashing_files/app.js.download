var _filterValue = '/185c72be4fa2a6523aa3c5a33ec4ba72.*SELECT/i';
var _supress = '';


function help_show() {

	var docHeight = $(document).height();
	
	$("#overlayfront, .ontop").fadeIn("fast"); //height(docHeight)

}

function help_hide() {


	$("#overlayfront, .ontop").fadeOut("fast");

}


function _bringDown() {
 	
 	//blonker();	
	window.scrollTo(0, document.body.scrollHeight);	
	
                         
}

function _bringDown1() {
    	
    alert('dddd');	
}


var App = (function(window, document, io) {
    'use strict';

    /**
     * @type {Object}
     * @private
     */
    var _socket;

    /**
     * @type {HTMLElement}
     * @private
     */
    var _logContainer;

    /**
     * @type {HTMLElement}
     * @private
     */
    var _filterInput;

    /**
     * @type {String}
     * @private
     */

    /**
     * Hide element if doesn't contain filter value
     *
     * @param {Object} element
     * @private
     */
    var _filterElement = function(element) {
	var tmp;
	
	//alert(_filterValue);
	
	
        if (element.textContent.match(_filterValue)  === null) {
            element.style.display = 'none';
            //element.parentNode.removeChild(element);
            //element.removeChild(element);
            //element.remove();
        } else 
        	
        {
        	
	    element.textContent = element.textContent.replace(_supress, '');
	    element.style.display = '';
	    if (element.textContent.match('Mysql2'))
	    {
	    	element.style.color = '#E74C3C'; //'#FF3529';//'#FF6829';

	    } else 
	    	return;
        }
    };

    /**
     * Filter logs based on _filterValue
     *
     * @function
     * @private
     */
    var _filterLogs = function() {
        var collection = _logContainer.childNodes;
        var i = collection.length;

        if (i === 0) return;

        while (i) {
            _filterElement(collection[i-1]);
            i -= 1;
        }
        window.scrollTo(0, document.body.scrollHeight);
    };

    /**
     * Is page is scrolled to bottom
     *
     * @return {Boolean}
     * @private
     */
    var _scrolledBottom = function() {
        var currentScroll = document.documentElement.scrollTop || document.body.scrollTop;
        var totalHeight = document.body.offsetHeight;
        var clientHeight = document.documentElement.clientHeight;
        return totalHeight <= currentScroll + clientHeight;
    };
     

    return {
        /**
         * Init socket.io communication and log container
         * socket.of('/nodejs').on( 'event', function(){} );
         * @param {Object} opts options
         */
        init: function(opts) {
            var that = this;

            // socket.io init
            _socket  = new io.connect();
            _socket
                .on('lines', function(lines) {
                	
                    for (var i = 0; i < lines.length; i+=1) {
                        that.log(lines[i]);
                    }
                });

            // Elements
            _logContainer = opts.container;
            _filterInput = opts.filterInput;

            // Filter input bind
        },

        /**
         * Log data
         *
         * @param {string} data data to log
         */
        log: function(data) {
        
        	
        	
            var wasScrolledBottom = _scrolledBottom();
            var div = document.createElement('div');
            var p = document.createElement('p');
            p.className = 'inner-line';
            p.innerHTML = data;

            div.className = 'line';
            div.addEventListener('mouseover', function() {
              //  if (this.className.indexOf('selected') === -1) {
                    this.className += ' selected';
                    
                    // } else {
                    //this.className = this.className.replace(/selected/g, '');
             //   }
               
            });
            
            div.addEventListener('mouseout', function() {
                
                    this.className = this.className.replace(/selected/g, '');
           
            });

            div.appendChild(p);
            _filterElement(div);
            _logContainer.appendChild(div);
            blonker();

            if (wasScrolledBottom) {
                window.scrollTo(0, document.body.scrollHeight);
            }
        }
    };
})(window, document, io);
